$schema: https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json
name: OSF
scopeName: source.osf
# Top-level patterns tried in order. Specific first!
patterns:
  - include: '#header'            # Match the apiVersion line
  - include: '#node_declaration'  # Match 'node node_id:'
  - include: '#node_properties'   # Match 'key: value' inside nodes
  - include: '#text_block'        # Match the multi-line text block (basic)
  - include: '#strings'           # Match standard double-quoted strings


repository:
  comments:
    patterns:
      - name: comment.line.number-sign.osf
        match: '#.*$'
  # Rule for the header line like 'apiVersion: dialogue/v1'
  header:
    patterns:
      - name: meta.header.osf
        # Match 'word:', optional whitespace, 'rest of line' at the start ^
        match: ^\s*([a-zA-Z_][a-zA-Z0-9_]*):\s*(.+)\s*$
        captures:
          '1': { name: entity.name.tag.osf }       # Style 'apiVersion' as a tag/key
          '2': { name: string.unquoted.value.osf } # Style 'dialogue/v1' as a value

  # Rule for 'node node_id:'
  node_declaration:
    patterns:
      - name: meta.node.declaration.osf
        # Match 'node', whitespace, 'node_id', ':' at the start ^
        match: '^(node)\s+([a-zA-Z_][a-zA-Z0-9_]*):\s*$'
        captures:
          '1': { name: keyword.control.osf }     # Style 'node' as a keyword
          '2': { name: entity.name.function.osf } # Style 'node_1' as an entity name

  node_properties:
    patterns:
      - name: meta.property.osf
        match: ^(\s+)([a-zA-Z_][a-zA-Z0-9_]*):\s*(.*)\s*$
        captures:
          '2':
            name: entity.name.tag.osf
          '3':
            name: string.unquoted.value.osf

  text_block:
    patterns:
      - name: string.unquoted.block.osf
        match: ^\s{4,}.+
  strings:
    name: string.quoted.double.osf
    begin: '"'
    end: '"'
    patterns:
      - name: constant.character.escape.osf
        match: \\.

